<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <title>Geographic Evolution of my Family</title>

    <link rel="stylesheet" href="http://api.tiles.mapbox.com/mapbox.js/v0.6.3/mapbox.css" type="text/css" />
    <link rel="stylesheet" href="style.css" type="text/css" />
    <link rel="stylesheet" href="css/mapbox.share.css" type="text/css" />
    <!--link rel="shortcut icon" href="img/mhouse-24.png" type="image/x-icon??"-->

    <script src='http://api.tiles.mapbox.com/mapbox.js/v0.6.3/mapbox.uncompressed.js'></script>
    <script src="ext/jquery.min.js"></script>
    <script src="ext/mapbox.jquery.js"></script>
    <script src="ext/mapbox.share.js"></script>
  </head>

  <body class="heroine">
    <header>
      <h1>Geographic Evolution of my Family</h1>
    </header>
    <div id="content">
      <div id="about">
        <h2>Timeline</h2>
        <div id="markerfilters" class="clearfix section">
          <a class="markerfilter selected" href="#all">All</a>
        </div>
        <p class='description'></p>
      </div>
    </div>
    
    <div id="map" class="map"></div>

    <!--script src="script.js" endtag-->
    <script>
      var map = mapbox.map('map');
      map.addLayer(mapbox.layer().id('http://a.tiles.mapbox.com/v3/crags617.cragin_homes_blnk.jsonp'));
      
      var timeline = document.getElementById('timeline'),
      	  controls = document.getElementById('controls');

      var markerLayer = mapbox.markers.layer()

      .filter(function() { return false })
      .url('https://docs.google.com/open?id=0B4nlwc2QbtjtMS01YWYwNGYyOC03ZmY0LTQ2YzMtODJmYS0zMDIzZDEwYjFlY2U', function(err, features) {

      function click_year(y) {
          return function() {
              var living = document.getElementsByClassName('start_year');
              if (active.length) active[0].className = '';
              document.getElementById('y' + y).className = 'start_year'';
              markerLayer.filter(function(f) {
                  return f.properties.year == y;
              });
              return false;
          };
      }

      var years = {},
          yearlist = [],
          year_links = [];

      for (var i = 0; i < features.length; i++) {
          years[features[i].properties.start_year] = true;
      }

      for (var y in years) yearlist.push(y);
      yearlist.sort();

      for (var i = 0; i < yearlist.length; i++) {
          var a = timeline.appendChild(document.createElement('a'));
          a.innerHTML = yearlist[i] + ' ';
          a.id = 'y' + yearlist[i];
          a.href = '#';
          a.onclick = click_year(yearlist[i]);
      }

      var stop = controls.appendChild(document.createElement('a')),
            play = controls.appendChild(document.createElement('a')),
            playStep;

      stop.innerHTML = 'STOP ■';
      play.innerHTML = 'PLAY ▶';

      play.onclick = function() {
          var step = 0;
          // Every quarter-second (250 ms) increment the year
          // we're looking at and show a new year. When
          // the end is reached, call clearInterval to stop
          // the animation.
          playStep = window.setInterval(function() {
              if (step < yearlist.length) {
                  click_year(yearlist[step])();
                  step++;
              } else {
                  window.clearInterval(playStep);
              }
          }, 250);
      };

      stop.onclick = function() {
          window.clearInterval(playStep);
      };

      click_year(2010)();
  });

  map.addLayer(markerLayer);
  map.zoom(3).center({ lat: 40, lon: -130 });

  // Attribute map
  map.ui.attribution.add()
      .content('<a href="http://mapbox.com/about/maps">Terms &amp; Feedback</a>');
    </script>

</body>
</html>
